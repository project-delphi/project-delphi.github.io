<!DOCTYPE html>
<html prefix="og: http://ogp.me/ns# article: http://ogp.me/ns/article#
" lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Jupyter Docker Stacks | Ravi Kalia Blog</title>
<link href="../../assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<link href="../../assets/css/ipython.min.css" rel="stylesheet" type="text/css">
<link href="../../assets/css/nikola_ipython.css" rel="stylesheet" type="text/css">
<meta name="theme-color" content="#5670d4">
<meta name="generator" content="Nikola (getnikola.com)">
<link rel="alternate" type="application/rss+xml" title="RSS" href="../../rss.xml">
<link rel="canonical" href="https://project-delphi.github.io/blog/jupyter-docker-stacks/">
<!--[if lt IE 9]><script src="../../assets/js/html5.js"></script><![endif]--><link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/latest/css/font-awesome.min.css">
<meta name="author" content="Ravi Kalia">
<link rel="prev" href="../on-robust-ml-production-systems-maybe/" title="On Robust ML Production Systems, Maybe" type="text/html">
<meta property="og:site_name" content="Ravi Kalia Blog">
<meta property="og:title" content="Jupyter Docker Stacks">
<meta property="og:url" content="https://project-delphi.github.io/blog/jupyter-docker-stacks/">
<meta property="og:description" content="Jupyter Docker Stacks¶DevOps¶On and Off, I have about 6 years of experience with DevOps methodology. It’s moved so fast and keeps going that early experiences with Chef, Ansible and earlier versions o">
<meta property="og:type" content="article">
<meta property="article:published_time" content="2019-10-21T06:25:28-04:00">
</head>
<body>
<a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>

<!-- Menubar -->

<nav class="navbar navbar-expand-md static-top mb-4
navbar-dark bg-dark
"><div class="container">
<!-- This keeps the margins nice -->
        <a class="navbar-brand" href="https://project-delphi.github.io/">

            <span id="blog-title">Ravi Kalia Blog</span>
        </a>
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#bs-navbar" aria-controls="bs-navbar" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>

        <div class="collapse navbar-collapse" id="bs-navbar">
            <ul class="navbar-nav mr-auto">
<li class="nav-item">
<a href="../../index.html" class="nav-link">Home</a>
                </li>
<li class="nav-item">
<a href="../../contact/index.html" class="nav-link">Contact</a>
                </li>
<li class="nav-item">
<a href="../../talks/index.html" class="nav-link">Talks</a>
                </li>
<li class="nav-item">
<a href="../../publications/index.html" class="nav-link">Publications</a>
                </li>
<li class="nav-item">
<a href="../../archive.html" class="nav-link">Blog</a>
                </li>
<li class="nav-item">
<a href="../../categories/" class="nav-link">Tags</a>

                
            </li>
</ul>
<ul class="navbar-nav navbar-right">
<li class="nav-item">
    <a href="index.ipynb" id="sourcelink" class="nav-link">Source</a>
    </li>


                
            </ul>
</div>
<!-- /.navbar-collapse -->
    </div>
<!-- /.container -->
</nav><!-- End of Menubar --><div class="container" id="content" role="main">
    <div class="body-content">
        <!--Body content-->
        
        
<article class="post-text h-entry hentry postpage" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title" itemprop="headline name"><a href="." class="u-url">Jupyter Docker Stacks</a></h1>

        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                    Ravi Kalia
            </span></p>
            <p class="dateline">
            <a href="." rel="bookmark">
            <time class="published dt-published" datetime="2019-10-21T06:25:28-04:00" itemprop="datePublished" title="2019-10-21">2019-10-21</time></a>
            </p>
                <p class="commentline">
        
    <a href="#disqus_thread" data-disqus-identifier="cache/posts/jupyter-docker-stacks.html">Comments</a>


            
        </p>
<p class="sourceline"><a href="index.ipynb" class="sourcelink">Source</a></p>

        </div>
        

    </header><div class="e-content entry-content" itemprop="articleBody text">
    <div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Jupyter-Docker-Stacks">Jupyter Docker Stacks<a class="anchor-link" href="#Jupyter-Docker-Stacks">¶</a>
</h2>
<h3 id="DevOps">DevOps<a class="anchor-link" href="#DevOps">¶</a>
</h3>
<p>On and Off, I have about 6 years of experience with DevOps methodology. It’s moved so fast and keeps going that early experiences with Chef, Ansible and earlier versions of Docker seem irrelevant. One sticking point I remember is the introduction of Docker and how it affected developers on Apple appliances. The Mac operating systems (OSX, macOS) have traditionally not played well with Docker.</p>
<p><img src="http://blog.adnansiddiqi.me/wp-content/uploads/2018/12/docker_logo.png" alt=""></p>
<p>However, Docker and DevOps generally allow careful dependency management. This is important particularly as I recently saw <a href="https://en.wikipedia.org/wiki/Dependency_hell">Dependency Hell</a>, and probably not for the last time. Reproducible results are a must and not a nice to have. Dependency hell really gets in the way of that.</p>
<p>As I mentioned Docker has traditionally played so slow on Apple products as to be an anti-pattern.</p>
<p><img src="https://www.tjohearn.com/wordpress/wp-content/uploads/2018/02/fire_whale-600x310.jpg" alt=""></p>
<p>This is do with how persistent data has been shared between Mac and running docker containers - very slowly using a concept of volumes. Let’s explain this below.</p>
<h3 id="Darwin-Is-Not-Linux">Darwin Is Not Linux<a class="anchor-link" href="#Darwin-Is-Not-Linux">¶</a>
</h3>
<p>There’s a long story about how Steve Jobs resurrected Apple. As a precursor he was involved in Next computers which developed a unix like OS called Darwin. In fact Darwin is a fork of BSD - Berkeley Software Distribution - itself based on UNIX. Linux meanwhile is a different OS, inspired by UNIX.</p>
<p>Docker relies on a linux-containers, and runs lightweight and fast in them. Apple OS’es don’t have linux-containers. Hence to run Docker on Apple and Microsoft has needed a VM of Linux - usually VirtualBox or VMWare.</p>
<p>In the past, using Docker on a Mac needed installing a specific version of VM software and hoping it would work well with Docker. This VM is the reason for the slowness Docker, in particular read/writes, on Apple.</p>
<p>So much so, that hackernews and reddit have been full of the anti-pattern of Docker on Apple.  This is because Docker has to talk to the VM which then talks to Apple OS and then talks to the hardware. There is the slowness.</p>
<h3 id="File-I/O">File I/O<a class="anchor-link" href="#File-I/O">¶</a>
</h3>
<p>The major slowness is observed when there is file I/O between the docker instance and the host OS. Docker abstracts the concept of read/writing between the host OS (in our case Apple) and the Docker instance as volumes. Volumes link directories in the two.</p>
<h3 id="Docker-Toolbox">Docker Toolbox<a class="anchor-link" href="#Docker-Toolbox">¶</a>
</h3>
<p>Apart from the slowness, the other issue has been getting a VM software to run on Apple. Docker released Docker Toolbox, which packages VirtualBox and Docker for legacy Apple and Windows OS’es - such as OSX.</p>
<p>This takes some of the pain out of installation and configuration. However latency remains pretty bad.</p>
<h3 id="Docker-For-Mac">Docker For Mac<a class="anchor-link" href="#Docker-For-Mac">¶</a>
</h3>
<p>There’s a new tool called Docker for Mac. This is making use of macOS container technologies directly and removes the need for a guest linux VM.</p>
<p>I’ve been running it and can attest that it is more lightweight and my Mac doesn’t sound like an airplane taking off with Docker running anymore.</p>
<h3 id="Volumes-are-now-better">Volumes are now better<a class="anchor-link" href="#Volumes-are-now-better">¶</a>
</h3>
<p>There’s been some clever work with volumes. delegated status allows the communication between Docker instances and macOS to run faster - still not as fast as linux containers, but much better than before.</p>
<h4 id="VS-Code-dials-into-Docker-Instances">VS Code dials into Docker Instances<a class="anchor-link" href="#VS-Code-dials-into-Docker-Instances">¶</a>
</h4>
<h4 id="NFS-is-coming">NFS is coming<a class="anchor-link" href="#NFS-is-coming">¶</a>
</h4>
<p>Back to Scientific Computing!</p>
<h3 id="Jupyter-Docker-Stacks">Jupyter Docker Stacks<a class="anchor-link" href="#Jupyter-Docker-Stacks">¶</a>
</h3>
<h4 id="joyvan">joyvan<a class="anchor-link" href="#joyvan">¶</a>
</h4>
<h4 id="Persisting-Data">Persisting Data<a class="anchor-link" href="#Persisting-Data">¶</a>
</h4>
<h3 id="Docker-Compose">Docker Compose<a class="anchor-link" href="#Docker-Compose">¶</a>
</h3>
<h4 id="Directory-Structure">Directory Structure<a class="anchor-link" href="#Directory-Structure">¶</a>
</h4>
<p><del>I may as well make explicit my assumption about the directory (not folder - this is *nix) structure assumed for development. This will feed into how volumes are shared in the <code>docker-compose.yml</code> file.</del></p>
<div class="highlight"><pre><span></span>Code
├── github.com
├── gitlab.com
└── throwaway
</pre></div>
<p>However, let’s scratch that. If we trust users to run  docker-compose files from inside their projects then we shouldn’t have record how their directories are laid out. Just specifying that we wish to mount/delegate the current directory to the docker instance's <code>jovyan</code> users work directory is enough.</p>
<p>Example Docker File</p>
<div class="highlight"><pre><span></span>
</pre></div>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Links">Links<a class="anchor-link" href="#Links">¶</a>
</h3>
<p>Some links I found useful in composing this post:</p>
<ul>
<li>
<p><a href="https://unsupervisedpandas.com/data-science/docker-for-data-science/">https://unsupervisedpandas.com/data-science/docker-for-data-science/</a></p>
</li>
<li>
<p><a href="https://docs.docker.com/compose/gettingstarted/">https://docs.docker.com/compose/gettingstarted/</a></p>
</li>
<li>
<p><a href="https://docs.docker.com/docker-for-mac/install/">https://docs.docker.com/docker-for-mac/install/</a></p>
</li>
<li>
<p><a href="https://docs.docker.com/compose/compose-file/#caching-options-for-volume-mounts-docker-for-mac">https://docs.docker.com/compose/compose-file/#caching-options-for-volume-mounts-docker-for-mac</a></p>
</li>
<li>
<p><a href="https://vivait.co.uk/labs/docker-for-mac-performance-using-nfs">https://vivait.co.uk/labs/docker-for-mac-performance-using-nfs</a></p>
</li>
<li>
<p><a href="https://stackoverflow.com/questions/43383276/how-does-docker-run-a-linux-kernel-under-macos-host">https://stackoverflow.com/questions/43383276/how-does-docker-run-a-linux-kernel-under-macos-host</a></p>
</li>
<li>
<p><a href="https://medium.com/fundbox-engineering/overview-d3759e83969c">https://medium.com/fundbox-engineering/overview-d3759e83969c</a></p>
</li>
<li>
<p><a href="https://spin.atomicobject.com/2019/10/14/docker-slow-mounted-volumes/">https://spin.atomicobject.com/2019/10/14/docker-slow-mounted-volumes/</a></p>
</li>
<li>
<p><a href="https://engageinteractive.co.uk/blog/making-docker-faster-on-mac">https://engageinteractive.co.uk/blog/making-docker-faster-on-mac</a></p>
</li>
<li>
<p><a href="https://blog.codeship.com/docker-for-windows-linux-and-mac/">https://blog.codeship.com/docker-for-windows-linux-and-mac/</a></p>
</li>
<li>
<p><a href="https://en.wikipedia.org/wiki/Berkeley_Software_Distribution">https://en.wikipedia.org/wiki/Berkeley_Software_Distribution</a></p>
</li>
<li>
<p><a href="https://towardsdatascience.com/jupyter-data-science-stack-docker-in-under-15-minutes-19d8f822bd45">https://towardsdatascience.com/jupyter-data-science-stack-docker-in-under-15-minutes-19d8f822bd45</a></p>
</li>
<li>
<p><a href="https://jupyter-docker-stacks.readthedocs.io/en/latest/index.html">https://jupyter-docker-stacks.readthedocs.io/en/latest/index.html</a></p>
</li>
<li>
<p><a href="https://github.com/stefanproell/jupyter-notebook-docker-compose">https://github.com/stefanproell/jupyter-notebook-docker-compose</a></p>
</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [ ]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span> 
</pre></div>

    </div>
</div>
</div>

</div>
</div>
    </div>
    <aside class="postpromonav"><nav><ul class="pager hidden-print">
<li class="previous">
                <a href="../on-robust-ml-production-systems-maybe/" rel="prev" title="On Robust ML Production Systems, Maybe">Previous post</a>
            </li>
        </ul></nav></aside><section class="comments hidden-print"><h2>Comments</h2>
        
        
        <div id="disqus_thread"></div>
        <script>
        var disqus_shortname ="https-project-delphi-github-io",
            disqus_url="https://project-delphi.github.io/blog/jupyter-docker-stacks/",
        disqus_title="Jupyter Docker Stacks",
        disqus_identifier="cache/posts/jupyter-docker-stacks.html",
        disqus_config = function () {
            this.language = "en";
        };
        (function() {
            var dsq = document.createElement('script'); dsq.async = true;
            dsq.src = 'https://' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script><noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a>
</noscript>
    <a href="https://disqus.com" class="dsq-brlink" rel="nofollow">Comments powered by <span class="logo-disqus">Disqus</span></a>


        </section><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML" integrity="sha256-SDRP1VVYu+tgAGKhddBSl5+ezofHKZeI+OzxakbIe/Y=" crossorigin="anonymous"></script><script type="text/x-mathjax-config">
        MathJax.Hub.Config({tex2jax: {inlineMath: [['$latex ','$'], ['\\(','\\)']]}});
        </script></article><script>var disqus_shortname="https-project-delphi-github-io";(function(){var a=document.createElement("script");a.async=true;a.src="https://"+disqus_shortname+".disqus.com/count.js";(document.getElementsByTagName("head")[0]||document.getElementsByTagName("body")[0]).appendChild(a)}());</script><!--End of body content--><footer id="footer"><div class="text-center">
<p>
<span class="fa-stack fa-2x">
  <a href="https://twitter.com/ravkalia1">
    <i class="fa fa-circle fa-stack-2x"></i>
    <i class="fa fa-twitter fa-inverse fa-stack-1x"></i>
  </a>
</span>
<span class="fa-stack fa-2x">
  <a href="https://github.com/project-delphi">
    <i class="fa fa-circle fa-stack-2x"></i>
    <i class="fa fa-github fa-inverse fa-stack-1x"></i>
  </a>
</span>
<span class="fa-stack fa-2x">
  <a href="https://www.linkedin.com/in/ravi-kalia-phd">
    <i class="fa fa-circle fa-stack-2x"></i>
    <i class="fa fa-linkedin fa-inverse fa-stack-1x"></i>
  </a>
</span>
<span class="fa-stack fa-2x">
  <a href="mailto:ravkalia@gmail.com">
    <i class="fa fa-circle fa-stack-2x"></i>
    <i class="fa fa-envelope fa-inverse fa-stack-1x"></i>
  </a>
</span>
</p>
<p>
  Contents © 2019  <a href="mailto:ravkalia@gmail.com">Ravi Kalia</a>
  —
  
  —
  Powered by <a href="https://getnikola.com" rel="nofollow">Nikola</a>
</p>
</div>

            
        </footer>
</div>
</div>


        <script src="../../assets/js/all-nocdn.js"></script><script>
    baguetteBox.run('div#content', {
        ignoreClass: 'islink',
        captions: function(element) {
            return element.getElementsByTagName('img')[0].alt;
    }});
    </script>
</body>
</html>
